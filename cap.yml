caps:
  - name: empty
  - name: memory
    fields:
      - begin 4
      - end 4
      - rwx 1
      - free 4
      - pmp 1
    asserts:
      - 'begin == free'
      - 'begin < end'
      - 'pmp == 0'
      - 'rwx == 0x4 || rwx == 0x5 || rwx == 0x6 || rwx == 0x7'
  - name: pmp
    fields:
      - addr 4
      - rwx 1
    asserts:
      - 'rwx == 0x4 || rwx == 0x5 || rwx == 0x6 || rwx == 0x7'
  - name: time
    fields:
      - hartid 1
      - begin 2
      - end 2
      - free 2
      - depth 1
    asserts:
      - 'MIN_HARTID <= hartid'
      - 'hartid <= MAX_HARTID'
      - 'begin == free'
      - 'begin < end'
      - 'end <= N_QUANTUM'
  - name: channels
    fields:
      - begin 2
      - end 2
      - free 2
    asserts:
      - 'begin == free'
      - 'begin < end'
      - 'end <= N_CHANNELS'
  - name: receiver 
    fields:
      - channel 2
    asserts:
      - 'channel < N_CHANNELS'
  - name: sender 
    fields:
      - channel 2
      - grant 1
    asserts:
      - 'channel < N_CHANNELS'
  - name: server 
    fields:
      - channel 2
      - grant 1
    asserts:
      - 'channel < N_CHANNELS'
  - name: client 
    fields:
      - channel 2
      - grant 1
    asserts:
      - 'channel < N_CHANNELS'
  - name: supervisor
    fields:
      - begin 1
      - end 1
      - free 1
    asserts:
      - 'begin == free'
      - 'begin < end'
      - 'end <= N_PROC'

predicates:
  - name: is_child_memory
    cases:
      - parent: memory
        child: memory
        conditions:
        - 'p:begin <= c:begin'
        - 'c:end <= p:end'
        - '(c:rwx & p:rwx) == c:rwx'
      - parent: memory
        child: pmp
        conditions:
          - 'p:begin <= pmp_napot_begin(c:addr)'
          - 'pmp_napot_end(c:addr) <= p:end'
          - '(c:rwx & p:rwx) == c:rwx'
  - name: is_child_time
    cases:
      - parent: time
        child: time
        conditions:
          - 'p:begin <= c:begin'
          - 'c:end <= p:end'
          - 'p:hartid == c:hartid'
          - 'p:depth < c:depth'
  - name: is_child_channels
    cases:
      - parent: channels
        child: channels
        conditions:
          - 'p:begin <= c:begin'
          - 'c:end <= p:end'
      - parent: channels
        child: receiver 
        conditions:
          - 'p:begin <= c:channel'
          - 'c:channel < p:end'
      - parent: channels
        child: sender
        conditions:
          - 'p:begin <= c:channel'
          - 'c:channel < p:end'
      - parent: channels
        child: server 
        conditions:
          - 'p:begin <= c:channel'
          - 'c:channel < p:end'
      - parent: channels
        child: client 
        conditions:
          - 'p:begin <= c:channel'
          - 'c:channel < p:end'
  - name: is_child_receiver
    cases:
      - parent: receiver 
        child: sender 
        conditions:
          - 'p:channel == c:channel'
  - name: is_child_server
    cases:
      - parent: server 
        child: client 
        conditions:
          - 'p:channel == c:channel'
  - name: is_child_supervisor
    cases:
      - parent: supervisor
        child: supervisor
        conditions:
          - 'p:begin <= c:begin'
          - 'c:end <= p:end'
  - name: can_derive_memory
    cases:
      - parent: memory
        child: memory  
        conditions:
          - 'p:pmp == 0'
          - 'c:pmp == 0'
          - 'p:free <= c:begin'
          - 'c:end <= p:end'
          - '(c:rwx & p:rwx) == c:rwx'
          - 'c:free == c:begin'
          - 'c:begin < c:end'
      - parent: memory
        child: pmp
        conditions:
          - 'p:free <= pmp_napot_begin(c:addr)'
          - 'pmp_napot_end(c:addr) <= p:end'
          - '(c:rwx & p:rwx) == c:rwx'
  - name: can_derive_time
    cases:
      - parent: time
        child: time
        conditions:
          - 'p:free <= c:begin'
          - 'c:end <= p:end'
          - 'p:hartid == c:hartid'
          - 'p:depth < c:depth'
          - 'c:free == c:begin'
          - 'c:begin < c:end'
  - name: can_derive_channels
    cases:
      - parent: channels
        child: channels
        conditions:
          - 'p:free <= c:begin'
          - 'c:end <= p:end'
          - 'c:free == c:begin'
          - 'c:begin < c:end'
      - parent: channels
        child: receiver
        conditions:
          - 'p:free <= c:channel'
          - 'c:channel < p:end'
      - parent: channels
        child: server
        conditions:
          - 'p:free <= c:channel'
          - 'c:channel < p:end'
  - name: can_derive_receiver
    cases:
      - parent: receiver 
        child: sender
        conditions:
          - 'p:channel == c:channel'
          - 'c:grant == 1 || c:grant == 0'
  - name: can_derive_server
    cases:
      - parent: server
        child: client
        conditions:
          - 'p:channel == c:channel'
          - 'c:grant == 1 || c:grant == 0'
  - name: can_derive_supervisor
    cases:
      - parent: supervisor
        child: supervisor
        conditions:
          - 'p:free <= c:begin'
          - 'c:end <= p:end'
          - 'c:free == c:begin'
          - 'c:begin < c:end'
